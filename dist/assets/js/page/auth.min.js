var i=class{#e;#t;#n;#r;#i=!1;#s;#o=!1;constructor(e,t){this.#e=document.getElementById(e),this.#e&&(this.#t=e,this.#n=`/auth/${t}`,this.#r=Date.now(),this.#s=this.#e.querySelector('button[type="submit"]'),this.#a())}#a(){this.#e.addEventListener("click",()=>this.#i=!0);let e=this.#e.querySelector(":scope > div");if(e){let t=document.createElement("input");t.type="hidden",t.name="source",t.value="deck",e.appendChild(t)}this.#e.addEventListener("submit",t=>{t.preventDefault(),this.#u()}),document.addEventListener("mousemove",()=>{this.#o=!0}),this.#t==="register-form"&&(this.#c(),this.#d())}async#c(){let e=this.#e.querySelector("#signup-username"),t;e.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(async()=>{let s=e.value.trim();if(s)try{let n=await(await fetch(`/auth/register/${s}?source=deck`)).json();console.log(n),n.available?e.parentElement.classList.remove("color-red"):(e.parentElement.classList.add("input-wrapper-danger"),Deck.say("This username is already taken.","danger"))}catch(r){console.error("Error checking username:",r)}},500)})}#d(){let e=this.#e.querySelector("#signup-password"),t=this.#e.querySelector("#signup-password-confirm");this.#s.disabled=!0;let s=()=>{let r=e.validity.valid&&t.validity.valid,n=e.value===t.value;this.#s.disabled=!(r&&n)};e.addEventListener("input",s),t.addEventListener("input",s)}async#u(){this.#s.disabled=!0,this.#e.setAttribute("action",this.#n);let e=new FormData(this.#e);e.append("csrfToken",document.body.getAttribute("data-csrfToken")||""),e.append("clicked",this.#i?"1":"0"),e.append("timeElapsed",(Date.now()-this.#r)/1e3),e.append("mouseMoved",this.#o?"1":"0"),e.append("source",this.#e.querySelector('[name="source"]')?.value);let t=Object.fromEntries(e.entries());try{let s=await fetch(`${this.#n}?source=deck`,{method:this.#e.method,headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});if(!s.ok){if(s.headers.get("content-type")?.includes("application/json")){let o=await s.json();throw new Error(o.message||"Unknown error")}throw new Error("Oops! Something went wrong.")}let r=await s.json();if(console.log(this.#t),console.log(e.get("username")),this.#t==="login-form"||this.#t==="register-form"){let n=e.get("username");window.location.href=`@${n}`}}catch(s){Deck.say(s.message,"danger"),this.#s.disabled=!1}}};new i("login-form","login");new i("register-form","register");new i("password-reset-form","reset");
